<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ë‹´ì„ ë©”ëª¨ì¥</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <style>
    :root{--theme:#2D3436;--theme-light:#636E72;--bg:#F8F6F1;--card:#FFF;--border:#E8E5DF;--text:#2D3436;--text-light:#B2ADA6;--text-mid:#636E72;--red:#D63031;--red-light:#E17055;--green:#00B894;--yellow:#FFEAA7}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);max-width:480px;margin:0 auto;min-height:100vh;min-height:100dvh;-webkit-tap-highlight-color:transparent}

    /* Splash */
    .splash{position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,var(--theme),var(--theme-light));display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity .4s,visibility .4s}
    .splash.hide{opacity:0;visibility:hidden}
    .splash-icon{width:72px;height:72px;background:rgba(255,255,255,.15);border-radius:20px;display:flex;align-items:center;justify-content:center;margin-bottom:20px;animation:sp 1.5s ease-in-out infinite}
    .splash-icon svg{width:36px;height:36px}
    .splash-title{color:#fff;font-size:22px;font-weight:800;margin-bottom:6px}
    .splash-sub{color:rgba(255,255,255,.5);font-size:13px}
    .splash-dots{margin-top:28px;display:flex;gap:6px}
    .splash-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.3);animation:db 1.2s ease-in-out infinite}
    .splash-dot:nth-child(2){animation-delay:.2s}.splash-dot:nth-child(3){animation-delay:.4s}
    @keyframes sp{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    @keyframes db{0%,80%,100%{opacity:.3;transform:scale(1)}40%{opacity:1;transform:scale(1.3)}}

    /* Setup Screen */
    .setup{display:none;padding:60px 24px 40px;text-align:center;min-height:100vh}
    .setup.active{display:block}
    .setup-icon{width:80px;height:80px;background:linear-gradient(135deg,var(--theme),var(--theme-light));border-radius:24px;display:flex;align-items:center;justify-content:center;margin:0 auto 24px}
    .setup-icon svg{width:40px;height:40px;color:white}
    .setup h1{font-size:22px;font-weight:800;margin-bottom:8px}
    .setup p{font-size:14px;color:var(--text-mid);line-height:1.6;margin-bottom:24px}
    .setup-input{width:100%;padding:16px;border-radius:14px;border:2px solid var(--border);font-size:14px;font-family:inherit;outline:none;transition:border .2s;background:white}
    .setup-input:focus{border-color:var(--theme)}
    .setup-btn{width:100%;padding:16px;border-radius:14px;border:none;background:linear-gradient(135deg,var(--theme),var(--theme-light));color:white;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit;margin-top:12px}
    .setup-btn:active{transform:scale(.97)}
    .setup-steps{text-align:left;background:white;border-radius:14px;padding:20px;margin-top:24px;border:1px solid var(--border)}
    .setup-step{font-size:13px;color:var(--text-mid);padding:6px 0;line-height:1.6}
    .setup-step strong{color:var(--text)}
    .setup-reset{background:none;border:none;color:var(--text-light);font-size:12px;cursor:pointer;font-family:inherit;margin-top:16px;text-decoration:underline}

    /* Header */
    .header{background:linear-gradient(135deg,var(--theme),var(--theme-light));padding:48px 24px 20px;color:white}
    .header-top{display:flex;justify-content:space-between;align-items:flex-start}
    .header-subtitle{font-size:12px;font-weight:500;opacity:.6;letter-spacing:2px;margin-bottom:4px}
    .header-title{font-size:24px;font-weight:800;letter-spacing:-.5px}
    .header-info{font-size:13px;opacity:.5;margin-top:4px}
    .mic-set-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.2);border-radius:10px;padding:8px 10px;cursor:pointer;display:flex;align-items:center;gap:4px;color:rgba(255,255,255,.7);margin-top:4px}

    /* Mic Guide */
    .mic-guide{display:none;background:white;border-bottom:1px solid var(--border);animation:sd .25s ease}
    @keyframes sd{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    .mic-guide-hd{display:flex;justify-content:space-between;align-items:center;padding:16px 20px 0}
    .mic-guide-hd span{font-weight:700;font-size:15px}
    .mic-guide-close{background:none;border:none;font-size:18px;color:var(--text-light);cursor:pointer;padding:4px 8px}
    .mic-guide-status{padding:8px 20px 0}
    .mic-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600}
    .mic-ok{background:#E8F8F0;color:var(--green)}.mic-no{background:#FDEDED;color:var(--red)}.mic-wait{background:#FFF8E1;color:#FF8F00}
    .mic-guide-body{padding:12px 20px}
    .mg-section{padding:8px 0}
    .mg-title{font-size:13px;font-weight:700;margin-bottom:8px}
    .mg-step{font-size:13px;color:var(--text-mid);padding:3px 0 3px 8px;border-left:2px solid var(--border);margin-bottom:4px;line-height:1.5}
    .mg-step strong{color:var(--text)}
    .mg-div{height:1px;background:var(--border);margin:4px 0}
    .mg-tip{padding:12px 20px 16px;font-size:12px;color:var(--green);font-weight:600;background:#F8FBF9;border-top:1px solid #E8F8F0}

    /* Tabs */
    .tab-bar{display:flex;background:white;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
    .tab-item{flex:1;padding:14px 0 12px;border:none;background:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:3px;font-size:11px;font-weight:500;font-family:inherit;color:var(--text-light);border-bottom:2.5px solid transparent;transition:all .2s}
    .tab-item.active{color:var(--text);font-weight:700;border-bottom-color:var(--text)}
    .tab-item svg{width:18px;height:18px}

    /* Content */
    .content{padding:20px 20px 100px}
    .tab-content{display:none}.tab-content.active{display:block}
    .section-label{font-size:12px;font-weight:700;color:var(--text-light);letter-spacing:1px;margin-bottom:10px}

    /* Voice */
    .voice-idle{text-align:center;padding-top:32px}
    .voice-guide{font-size:14px;color:var(--text-mid);margin-bottom:32px;line-height:1.7}
    .voice-guide strong{color:var(--text)}
    .mic-btn{width:120px;height:120px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--red-light),var(--red));color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;margin:0 auto;box-shadow:0 8px 32px rgba(214,48,49,.35);transition:transform .2s}
    .mic-btn:active{transform:scale(.95)}
    .mic-btn svg{width:48px;height:48px}
    .mic-btn.recording{animation:pulse 1.5s ease-in-out infinite}
    @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(214,48,49,.4)}50%{box-shadow:0 0 0 24px rgba(214,48,49,0)}}
    .realtime-text{min-height:40px;margin-top:20px;padding:16px;background:white;border-radius:12px;border:2px solid var(--border);font-size:16px;font-weight:500;text-align:left;word-break:keep-all;opacity:0;transition:opacity .3s}
    .realtime-text.visible{opacity:1}
    .realtime-text.has-text{border-color:var(--red-light)}
    .voice-example{background:white;padding:12px 16px;border-radius:12px;margin-bottom:8px;font-size:14px;border:1px solid var(--border)}

    /* Confirm */
    .confirm-card{background:white;border-radius:16px;padding:24px 20px;border:1px solid var(--border);text-align:left;margin-bottom:16px}
    .confirm-tags{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
    .tag{padding:4px 12px;border-radius:20px;font-size:13px;font-weight:600}
    .tag-student{background:#DFE6E9}.tag-category{background:var(--yellow)}.tag-fuzzy{background:#FDEDED;color:var(--red);font-size:11px}
    .confirm-input{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:inherit;font-weight:500;background:var(--bg);outline:none;transition:border .2s}
    .confirm-input:focus{border-color:var(--text)}
    .confirm-hint{font-size:12px;color:var(--text-light);margin-top:8px}

    /* Buttons */
    .btn-row{display:flex;gap:10px;margin-top:16px}
    .btn{flex:1;padding:16px;border-radius:12px;border:none;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .15s}
    .btn:active{transform:scale(.97)}
    .btn-cancel{background:white;border:1px solid var(--border);color:var(--text-mid)}
    .btn-save{flex:2;background:linear-gradient(135deg,var(--theme),var(--theme-light));color:white}
    .btn-full{width:100%;padding:16px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--theme),var(--theme-light));color:white;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit;margin-top:24px}
    .btn-full:active{transform:scale(.97)}

    /* Manual */
    .toggle-bar{display:flex;background:#E8E5DF;border-radius:12px;padding:3px;margin-bottom:20px}
    .toggle-item{flex:1;padding:10px 0;border-radius:10px;border:none;background:transparent;font-weight:500;font-size:14px;cursor:pointer;font-family:inherit;color:var(--text-light);transition:all .2s}
    .toggle-item.active{background:white;color:var(--text);font-weight:700;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .student-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:24px}
    .student-btn{padding:10px 4px;border-radius:10px;border:1px solid var(--border);background:white;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;transition:all .15s;text-align:center}
    .student-btn .num{font-size:10px;opacity:.4}
    .student-btn.selected{border:2px solid var(--text);background:var(--text);color:white;font-weight:700}
    .student-btn.selected .num{opacity:.7}
    .category-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:24px}
    .category-tag{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:500;background:white;border:1px solid var(--border);color:var(--text-mid);cursor:pointer;transition:all .15s}
    .category-tag.selected{background:var(--text);color:white;border-color:var(--text)}
    textarea.memo-input{width:100%;height:120px;padding:16px;border-radius:12px;border:1px solid var(--border);font-size:15px;font-family:inherit;resize:none;background:white;outline:none}
    textarea.memo-input:focus{border-color:var(--text)}
    input.text-input{width:100%;padding:14px 16px;border-radius:12px;border:1px solid var(--border);font-size:15px;font-family:inherit;background:white;outline:none}
    input.text-input:focus{border-color:var(--text)}
    .point-type-row{display:flex;gap:10px;margin-bottom:20px}
    .point-type-btn{flex:1;padding:14px;border-radius:12px;border:1px solid var(--border);background:white;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;color:var(--text-mid);transition:all .15s}
    .point-type-btn.merit{background:var(--green);color:white;border:none}
    .point-type-btn.demerit{background:var(--red);color:white;border:none}
    .score-row{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:20px}
    .score-btn{width:44px;height:44px;border-radius:50%;border:1px solid var(--border);background:white;font-size:20px;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center}
    .score-display{font-size:36px;font-weight:800;min-width:60px;text-align:center}

    /* Search */
    .search-box{position:relative;margin-bottom:20px}
    .search-box input{width:100%;padding:14px 16px 14px 44px;border-radius:12px;border:1px solid var(--border);font-size:15px;font-family:inherit;background:white;outline:none}
    .search-box input:focus{border-color:var(--text)}
    .search-box svg{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text-light)}
    .student-list{display:flex;flex-direction:column;gap:8px}
    .student-card{display:flex;align-items:center;padding:16px;border-radius:14px;border:1px solid var(--border);background:white;cursor:pointer;transition:all .15s}
    .student-card:active{background:var(--bg)}
    .student-avatar{width:40px;height:40px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--text-mid);margin-right:14px;flex-shrink:0}
    .student-card-name{font-size:16px;font-weight:700}
    .student-card-meta{font-size:12px;color:var(--text-light);margin-top:2px}
    .student-card-arrow{color:var(--border);font-size:20px}
    .pts-pos{color:var(--green);font-weight:600}.pts-neg{color:var(--red);font-weight:600}
    .back-btn{background:none;border:none;font-size:14px;color:var(--text-mid);cursor:pointer;font-family:inherit;margin-bottom:16px;display:flex;align-items:center;gap:6px}
    .detail-header{background:white;border-radius:16px;padding:24px 20px;margin-bottom:16px;border:1px solid var(--border);text-align:center}
    .detail-avatar{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--theme),var(--theme-light));display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:white;margin:0 auto 12px}
    .detail-name{font-size:22px;font-weight:800}
    .detail-stats{display:flex;justify-content:center;gap:20px;margin-top:16px}
    .detail-stat-num{font-size:24px;font-weight:800}
    .detail-stat-label{font-size:11px;color:var(--text-light)}
    .detail-stat-divider{width:1px;background:var(--border)}
    .memo-item{background:white;border-radius:12px;padding:14px 16px;margin-bottom:8px;border:1px solid var(--border)}
    .memo-item-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .memo-category{padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600}
    .memo-date{font-size:11px;color:var(--text-light)}
    .memo-content{font-size:15px;font-weight:500}
    .point-item{background:white;border-radius:12px;padding:14px 16px;margin-bottom:8px;border:1px solid var(--border);display:flex;align-items:center}
    .point-badge{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;margin-right:14px;flex-shrink:0}
    .point-badge.merit{background:#E8F8F0;color:var(--green)}.point-badge.demerit{background:#FDEDED;color:var(--red)}
    .point-reason{font-size:14px;font-weight:600}.point-date{font-size:11px;color:var(--text-light);margin-top:2px}
    .empty-state{background:white;border-radius:12px;padding:20px;text-align:center;color:var(--text-light);font-size:14px;border:1px solid var(--border)}

    /* Toast & Loading */
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--text);color:white;padding:14px 24px;border-radius:12px;font-size:14px;font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,.2);z-index:1000;opacity:0;transition:all .3s;white-space:nowrap}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(248,246,241,.6);display:none;align-items:center;justify-content:center;z-index:999}
    .loading-overlay.show{display:flex}
    .loading-spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--text);border-radius:50%;animation:spin .7s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .app-wrap{opacity:0;transition:opacity .3s}.app-wrap.ready{opacity:1}

    /* Category Colors */
    .cat-ì¶œê²°{background:#FFF3E0;color:#E17055}.cat-ìƒë‹´{background:#E8F0FE;color:#4A90D9}.cat-ê±´ê°•{background:#FCE4EC;color:#E91E63}
    .cat-êµìš°ê´€ê³„{background:#F3E5F5;color:#9C27B0}.cat-ì¹­ì°¬{background:#E8F8F0;color:var(--green)}.cat-í•™ìŠµ{background:#FFF8E1;color:#FF8F00}
    .cat-ìƒí™œì§€ë„{background:#EFEBE9;color:#795548}.cat-ì§„ë¡œ{background:#E0F7FA;color:#00838F}.cat-ê°€ì •ì—°ë½{background:#F1F8E9;color:#558B2F}
    .cat-ì¼ë°˜{background:#F0F0F0;color:#636E72}.cat-íŠ¹ì´ì‚¬í•­{background:#FBE9E7;color:#BF360C}
  </style>
</head>
<body>

<!-- Splash -->
<div id="splash" class="splash">
  <div class="splash-icon"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg></div>
  <div class="splash-title" id="splashTitle">ë‹´ì„ ë©”ëª¨ì¥</div>
  <div class="splash-sub" id="splashSub">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div class="splash-dots"><div class="splash-dot"></div><div class="splash-dot"></div><div class="splash-dot"></div></div>
</div>

<!-- Setup Screen -->
<div id="setupScreen" class="setup">
  <div class="setup-icon"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg></div>
  <h1>ë‹´ì„ ë©”ëª¨ì¥ ì—°ê²°</h1>
  <p>êµ¬ê¸€ ì‹œíŠ¸ì™€ ì—°ê²°í•˜ê¸° ìœ„í•´<br>GAS ì›¹ì•± ë°°í¬ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
  <input type="text" class="setup-input" id="apiUrlInput" placeholder="https://script.google.com/macros/s/.../exec">
  <button class="setup-btn" onclick="saveApiUrl()">ì—°ê²°í•˜ê¸°</button>
  <div class="setup-steps">
    <div class="section-label">ğŸ“‹ ì„¤ì • ë°©ë²•</div>
    <div class="setup-step">1. êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ <strong>í™•ì¥ í”„ë¡œê·¸ë¨ â†’ Apps Script</strong></div>
    <div class="setup-step">2. Code.gsì— ë°±ì—”ë“œ ì½”ë“œ ë¶™ì—¬ë„£ê¸°</div>
    <div class="setup-step">3. <strong>initializeSheets</strong> í•¨ìˆ˜ ì‹¤í–‰ (ì‹œíŠ¸ ìë™ ìƒì„±)</div>
    <div class="setup-step">4. <strong>ë°°í¬ â†’ ìƒˆ ë°°í¬ â†’ ì›¹ ì•±</strong></div>
    <div class="setup-step">5. ì•¡ì„¸ìŠ¤ ê¶Œí•œ: <strong>"ëª¨ë“  ì‚¬ìš©ì"</strong> ì„ íƒ</div>
    <div class="setup-step">6. ë°°í¬ëœ URLì„ ìœ„ì— ë¶™ì—¬ë„£ê¸°</div>
  </div>
</div>

<!-- Loading & Toast -->
<div id="loading" class="loading-overlay"><div class="loading-spinner"></div></div>
<div id="toast" class="toast"></div>

<!-- App -->
<div class="app-wrap" id="appWrap">
  <div class="header" id="appHeader">
    <div class="header-top">
      <div>
        <div class="header-subtitle" id="headerSubtitle">HOMEROOM</div>
        <div class="header-title" id="headerTitle">ë‹´ì„ ë©”ëª¨ì¥</div>
        <div class="header-info" id="headerInfo"></div>
      </div>
      <button class="mic-set-btn" onclick="toggleMicGuide()" title="ë§ˆì´í¬ ì„¤ì •">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </button>
    </div>
  </div>

  <div id="micGuide" class="mic-guide">
    <div class="mic-guide-hd"><span>ğŸ™ï¸ ë§ˆì´í¬ ì„¤ì • ì•ˆë‚´</span><button class="mic-guide-close" onclick="toggleMicGuide()">âœ•</button></div>
    <div class="mic-guide-status" id="micStatus"></div>
    <div class="mic-guide-body">
      <div class="mg-section"><div class="mg-title">ğŸ“± ëª¨ë°”ì¼</div><div class="mg-step">1. ì£¼ì†Œì°½ ì™¼ìª½ <strong>â“˜ ì•„ì´ì½˜</strong> í„°ì¹˜</div><div class="mg-step">2. <strong>"ê¶Œí•œ"</strong> í„°ì¹˜ â†’ ë§ˆì´í¬ <strong>"í—ˆìš©"</strong></div></div>
      <div class="mg-div"></div>
      <div class="mg-section"><div class="mg-title">ğŸ’» PC í¬ë¡¬</div><div class="mg-step">1. ì£¼ì†Œì°½ ì™¼ìª½ <strong>ìŠ¬ë¼ì´ë” ì•„ì´ì½˜</strong> í´ë¦­</div><div class="mg-step">2. <strong>"ì‚¬ì´íŠ¸ ì„¤ì •"</strong> â†’ ë§ˆì´í¬ â†’ <strong>"í—ˆìš©"</strong></div></div>
    </div>
    <div class="mg-tip">ğŸ’¡ ì²˜ìŒ ë§ˆì´í¬ ë²„íŠ¼ ëˆ„ë¥´ë©´ í—ˆìš© íŒì—…ì´ ìë™ìœ¼ë¡œ ë– ìš”!<br><button class="setup-reset" onclick="resetApiUrl()">ğŸ”„ GAS URL ì¬ì„¤ì •</button></div>
  </div>

  <div class="tab-bar">
    <button class="tab-item active" data-tab="voice" onclick="switchTab('voice')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>ìŒì„±ì…ë ¥</button>
    <button class="tab-item" data-tab="manual" onclick="switchTab('manual')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>ìˆ˜ê¸°ì…ë ¥</button>
    <button class="tab-item" data-tab="search" onclick="switchTab('search')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>ì¡°íšŒ</button>
  </div>

  <div class="content">
    <!-- VOICE TAB -->
    <div id="tab-voice" class="tab-content active">
      <div id="voiceIdle" class="voice-idle">
        <div class="voice-guide">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ê³ <br><strong>"í•™ìƒì´ë¦„ + ë©”ëª¨ë‚´ìš©"</strong>ì„ ë§í•´ì£¼ì„¸ìš”</div>
        <button class="mic-btn" id="micBtn" onclick="startVoice()"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg></button>
        <div id="realtimeText" class="realtime-text"></div>
        <div style="margin-top:32px;text-align:left"><div class="section-label">ì…ë ¥ ì˜ˆì‹œ</div><div class="voice-example">ğŸ’¬ "ê¹€ì£¼í˜„ 5êµì‹œ ì¡°í‡´"</div><div class="voice-example">ğŸ’¬ "ë°•ì„œì—° ì–´ë¨¸ë‹ˆ ì „í™” ìƒë‹´í•¨"</div><div class="voice-example">ğŸ’¬ "ì´ë„ìœ¤ ì²´ìœ¡ì‹œê°„ ë°œëª© ë¶€ìƒ"</div></div>
      </div>
      <div id="voiceConfirm" style="display:none;padding-top:20px">
        <div class="section-label">ìŒì„± ì¸ì‹ ê²°ê³¼</div>
        <div class="confirm-card"><div class="confirm-tags" id="confirmTags"></div><input type="text" class="confirm-input" id="confirmContent" placeholder="ë©”ëª¨ ë‚´ìš©"><div class="confirm-hint">ì¸ì‹ì´ í‹€ë ¸ë‹¤ë©´ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”</div></div>
        <div id="studentSelect" style="display:none;margin-bottom:16px"><div class="section-label">í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”</div><div class="student-grid" id="voiceStudentGrid"></div></div>
        <div class="btn-row"><button class="btn btn-cancel" onclick="cancelVoice()">ì·¨ì†Œ</button><button class="btn btn-save" onclick="saveVoiceMemo()">ì €ì¥í•˜ê¸°</button></div>
        <div style="text-align:center;margin-top:12px"><button style="background:none;border:none;color:var(--text-light);font-size:13px;cursor:pointer;font-family:inherit" onclick="cancelVoice();startVoice()">ğŸ™ï¸ ë‹¤ì‹œ ë…¹ìŒí•˜ê¸°</button></div>
      </div>
    </div>
    <!-- MANUAL TAB -->
    <div id="tab-manual" class="tab-content">
      <div class="toggle-bar"><button class="toggle-item active" data-type="memo" onclick="switchManualType('memo')">ë©”ëª¨ ê¸°ë¡</button><button class="toggle-item" data-type="points" onclick="switchManualType('points')">ìƒë²Œì </button></div>
      <div class="section-label">í•™ìƒ ì„ íƒ</div><div class="student-grid" id="manualStudentGrid"></div>
      <div id="memoForm"><div class="section-label">ì¹´í…Œê³ ë¦¬</div><div class="category-tags" id="categoryTags"></div><div class="section-label">ë©”ëª¨ ë‚´ìš©</div><textarea class="memo-input" id="manualMemoContent" placeholder="ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><button class="btn-full" onclick="saveManualMemo()">ì €ì¥í•˜ê¸°</button></div>
      <div id="pointsForm" style="display:none"><div class="section-label">ìœ í˜•</div><div class="point-type-row"><button class="point-type-btn merit" id="btnMerit" onclick="switchPointType('ìƒì ')">ğŸ‘ ìƒì </button><button class="point-type-btn" id="btnDemerit" onclick="switchPointType('ë²Œì ')">ğŸ‘ ë²Œì </button></div><div class="section-label">ì ìˆ˜</div><div class="score-row"><button class="score-btn" onclick="changeScore(-1)">âˆ’</button><div class="score-display" id="scoreDisplay">+1</div><button class="score-btn" onclick="changeScore(1)">+</button></div><div class="section-label">ì‚¬ìœ </div><input type="text" class="text-input" id="pointReason" placeholder="ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."><button class="btn-full" onclick="saveManualPoints()">ì €ì¥í•˜ê¸°</button></div>
    </div>
    <!-- SEARCH TAB -->
    <div id="tab-search" class="tab-content">
      <div id="searchList"><div class="search-box"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg><input type="text" id="searchInput" placeholder="í•™ìƒ ì´ë¦„ ê²€ìƒ‰..." oninput="filterStudents()"></div><div class="student-list" id="studentList"></div></div>
      <div id="detailView" style="display:none"><button class="back-btn" onclick="backToList()">â† ëª©ë¡ìœ¼ë¡œ</button><div class="detail-header" id="detailHeader"></div><div id="detailMemos"></div><div id="detailPoints" style="margin-top:20px"></div></div>
    </div>
  </div>
</div>

<script>
var students=[],settings={},selectedStudent=null,manualSelectedStudent=null,selectedCategory=null,currentPointType='ìƒì ',currentScore=1,recognition=null,voiceResult=null,micStream=null;
var CATEGORIES=['ì¶œê²°','ìƒí™œì§€ë„','ìƒë‹´','í•™ìŠµ','ê±´ê°•','êµìš°ê´€ê³„','ê°€ì •ì—°ë½','ì¹­ì°¬','ì§„ë¡œ','íŠ¹ì´ì‚¬í•­'];
var API_URL='';

// === API ===
function callServer(action,params){
  params=params||{};
  var body=JSON.stringify(Object.assign({action:action},params));
  return fetch(API_URL,{method:'POST',headers:{'Content-Type':'text/plain;charset=utf-8'},body:body,redirect:'follow'})
    .then(function(r){return r.json();})
    .then(function(d){if(d&&d.error)throw new Error(d.error);return d;});
}

// === URL ì„¤ì • ===
window.onload=function(){
  var saved=localStorage.getItem('gasApiUrl');
  if(saved){
    API_URL=saved;
    document.getElementById('splash').classList.remove('hide');
    document.getElementById('setupScreen').classList.remove('active');
    loadApp();
  } else {
    document.getElementById('splash').classList.add('hide');
    document.getElementById('setupScreen').classList.add('active');
  }
};

function saveApiUrl(){
  var url=document.getElementById('apiUrlInput').value.trim();
  if(!url||url.indexOf('script.google.com')<0){showToast('ì˜¬ë°”ë¥¸ GAS ë°°í¬ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  API_URL=url;
  localStorage.setItem('gasApiUrl',url);
  document.getElementById('setupScreen').classList.remove('active');
  document.getElementById('splash').style.display='flex';
  document.getElementById('splash').classList.remove('hide');
  loadApp();
}

function resetApiUrl(){
  localStorage.removeItem('gasApiUrl');
  location.reload();
}

// === ì´ˆê¸°í™” ===
function loadApp(){
  callServer('getAppData').then(function(data){
    settings=data.settings;students=data.students;
    document.getElementById('splashTitle').textContent=settings.appName||'ë‹´ì„ ë©”ëª¨ì¥';
    document.getElementById('splashSub').textContent=(settings.teacherName||'')+' ì„ ìƒë‹˜ì˜ ë©”ëª¨ì¥';
    applySettings();finishLoading();
  }).catch(function(err){
    document.getElementById('splashSub').textContent='ì—°ê²° ì‹¤íŒ¨ - URLì„ í™•ì¸í•´ì£¼ì„¸ìš”';
    document.getElementById('splash').querySelector('.splash-dots').innerHTML='<button onclick="resetApiUrl()" style="padding:10px 20px;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);border-radius:10px;color:white;font-size:13px;cursor:pointer;font-family:inherit">URL ì¬ì„¤ì •</button>';
    console.error(err);
  });
}

function finishLoading(){renderAll();document.getElementById('appWrap').classList.add('ready');setTimeout(function(){document.getElementById('splash').classList.add('hide');},300);}

function applySettings(){
  document.getElementById('headerSubtitle').textContent=settings.subtitle||'HOMEROOM';
  document.getElementById('headerTitle').textContent=settings.appName||'ë‹´ì„ ë©”ëª¨ì¥';
  var info=[];if(settings.className)info.push(settings.className);if(settings.teacherName)info.push(settings.teacherName+' ì„ ìƒë‹˜');
  document.getElementById('headerInfo').textContent=info.join(' Â· ');
  if(settings.themeColor){document.documentElement.style.setProperty('--theme',settings.themeColor);document.querySelector('.header').style.background='linear-gradient(135deg,'+settings.themeColor+','+lighten(settings.themeColor,30)+')';}
}
function lighten(h,p){var n=parseInt(h.replace('#',''),16),a=Math.round(2.55*p);return '#'+(0x1000000+Math.min(255,(n>>16)+a)*0x10000+Math.min(255,((n>>8)&0xFF)+a)*0x100+Math.min(255,(n&0xFF)+a)).toString(16).slice(1);}
function renderAll(){renderManualStudentGrid();renderCategoryTags();renderStudentList();}

// === íƒ­ ===
function switchTab(id){
  document.querySelectorAll('.tab-item').forEach(function(t){t.classList.remove('active');});
  document.querySelector('[data-tab="'+id+'"]').classList.add('active');
  document.querySelectorAll('.tab-content').forEach(function(c){c.classList.remove('active');});
  document.getElementById('tab-'+id).classList.add('active');
  if(id==='search')loadStudentsSummary();
}

// === ìŒì„± ===
function startVoice(){
  if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window)){showToast('í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');return;}
  var mb=document.getElementById('micBtn'),rt=document.getElementById('realtimeText');
  navigator.mediaDevices.getUserMedia({audio:true}).then(function(stream){
    micStream=stream;
    var SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    recognition=new SR();recognition.lang='ko-KR';recognition.continuous=false;recognition.interimResults=true;
    mb.classList.add('recording');rt.classList.add('visible');rt.textContent='ë“£ê³  ìˆì–´ìš”...';rt.classList.remove('has-text');
    recognition.onresult=function(e){
      var interim='',final='';
      for(var i=e.resultIndex;i<e.results.length;i++){if(e.results[i].isFinal)final+=e.results[i][0].transcript;else interim+=e.results[i][0].transcript;}
      var t=final||interim;if(t){rt.textContent=t;rt.classList.add('has-text');}
      if(final){mb.classList.remove('recording');stopMic();processVoice(final.trim());}
    };
    recognition.onerror=function(e){mb.classList.remove('recording');rt.classList.remove('visible');stopMic();if(e.error==='no-speech')showToast('ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ì–´ìš”.');else if(e.error!=='aborted')showToast('ìŒì„± ì˜¤ë¥˜: '+e.error);};
    recognition.onend=function(){mb.classList.remove('recording');};
    recognition.start();
  }).catch(function(err){
    if(err.name==='NotAllowedError'){showToast('ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”. ğŸ™ï¸? ë²„íŠ¼ ì°¸ê³ ');var g=document.getElementById('micGuide');if(g.style.display!=='block'){toggleMicGuide();}}
    else showToast('ë§ˆì´í¬ ì˜¤ë¥˜: '+err.message);
  });
}
function stopMic(){if(micStream){micStream.getTracks().forEach(function(t){t.stop();});micStream=null;}}
function processVoice(text){callServer('processVoiceInput',{text:text}).then(function(r){voiceResult=r;showConfirm(r);}).catch(handleError);}

function showConfirm(r){
  document.getElementById('voiceIdle').style.display='none';document.getElementById('voiceConfirm').style.display='block';
  var t=document.getElementById('confirmTags');t.innerHTML='';
  if(r.matched){t.innerHTML+='<span class="tag tag-student">'+r.student.num+'ë²ˆ '+r.student.name+'</span>';if(r.isFuzzy)t.innerHTML+='<span class="tag tag-fuzzy">âš ï¸ ìœ ì‚¬ë§¤ì¹­</span>';}
  else{t.innerHTML+='<span class="tag tag-fuzzy">âš ï¸ í•™ìƒì„ ì°¾ì§€ ëª»í–ˆì–´ìš”</span>';showVoiceGrid();}
  t.innerHTML+='<span class="tag tag-category">'+r.category+'</span>';
  document.getElementById('confirmContent').value=r.content;
  if(r.matched){selectedStudent=r.student;document.getElementById('studentSelect').style.display='none';}
}
function showVoiceGrid(){
  var g=document.getElementById('voiceStudentGrid');g.innerHTML='';
  students.forEach(function(s){var b=document.createElement('button');b.className='student-btn';b.innerHTML='<div class="num">'+s.num+'</div>'+s.name;b.onclick=function(){g.querySelectorAll('.student-btn').forEach(function(x){x.classList.remove('selected');});b.classList.add('selected');selectedStudent=s;var t=document.getElementById('confirmTags');var st=t.querySelector('.tag-student');if(st)st.remove();var ft=t.querySelector('.tag-fuzzy');if(ft)ft.remove();t.insertAdjacentHTML('afterbegin','<span class="tag tag-student">'+s.num+'ë²ˆ '+s.name+'</span>');};g.appendChild(b);});
  document.getElementById('studentSelect').style.display='block';
}
function saveVoiceMemo(){
  if(!selectedStudent){showToast('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');return;}
  var c=document.getElementById('confirmContent').value.trim();if(!c){showToast('ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  showLoading(true);
  callServer('saveMemo',{studentNum:selectedStudent.num,studentName:selectedStudent.name,content:c,category:voiceResult?voiceResult.category:'ì¼ë°˜'})
  .then(function(r){showLoading(false);if(r.success){showToast('âœ… ì €ì¥ ì™„ë£Œ!');cancelVoice();}else showToast('ì €ì¥ ì‹¤íŒ¨');}).catch(handleError);
}
function cancelVoice(){document.getElementById('voiceIdle').style.display='block';document.getElementById('voiceConfirm').style.display='none';document.getElementById('realtimeText').classList.remove('visible','has-text');document.getElementById('realtimeText').textContent='';selectedStudent=null;voiceResult=null;stopMic();if(recognition){try{recognition.abort();}catch(e){}recognition=null;}}

// === ìˆ˜ê¸° ===
function switchManualType(type){document.querySelectorAll('.toggle-item').forEach(function(t){t.classList.remove('active');});document.querySelector('[data-type="'+type+'"]').classList.add('active');document.getElementById('memoForm').style.display=type==='memo'?'block':'none';document.getElementById('pointsForm').style.display=type==='points'?'block':'none';}
function renderManualStudentGrid(){var g=document.getElementById('manualStudentGrid');g.innerHTML='';students.forEach(function(s){var b=document.createElement('button');b.className='student-btn';b.innerHTML='<div class="num">'+s.num+'</div>'+s.name;b.onclick=function(){g.querySelectorAll('.student-btn').forEach(function(x){x.classList.remove('selected');});b.classList.add('selected');manualSelectedStudent=s;};g.appendChild(b);});}
function renderCategoryTags(){var c=document.getElementById('categoryTags');c.innerHTML='';CATEGORIES.forEach(function(cat){var t=document.createElement('button');t.className='category-tag';t.textContent=cat;t.onclick=function(){c.querySelectorAll('.category-tag').forEach(function(x){x.classList.remove('selected');});t.classList.add('selected');selectedCategory=cat;};c.appendChild(t);});}

function saveManualMemo(){
  if(!manualSelectedStudent){showToast('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');return;}
  var content=document.getElementById('manualMemoContent').value.trim();if(!content){showToast('ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  showLoading(true);
  var cat=selectedCategory;
  if(!cat){
    callServer('autoCategory',{text:content}).then(function(r){return callServer('saveMemo',{studentNum:manualSelectedStudent.num,studentName:manualSelectedStudent.name,content:content,category:r.category||r});})
    .then(function(r){showLoading(false);if(r.success){showToast('âœ… ì €ì¥ ì™„ë£Œ!');document.getElementById('manualMemoContent').value='';selectedCategory=null;document.querySelectorAll('.category-tag').forEach(function(t){t.classList.remove('selected');});}}).catch(handleError);
  } else {
    callServer('saveMemo',{studentNum:manualSelectedStudent.num,studentName:manualSelectedStudent.name,content:content,category:cat})
    .then(function(r){showLoading(false);if(r.success){showToast('âœ… ì €ì¥ ì™„ë£Œ!');document.getElementById('manualMemoContent').value='';selectedCategory=null;document.querySelectorAll('.category-tag').forEach(function(t){t.classList.remove('selected');});}}).catch(handleError);
  }
}

function switchPointType(type){currentPointType=type;document.getElementById('btnMerit').className='point-type-btn'+(type==='ìƒì '?' merit':'');document.getElementById('btnDemerit').className='point-type-btn'+(type==='ë²Œì '?' demerit':'');updateScore();}
function changeScore(d){currentScore=Math.max(1,Math.min(10,currentScore+d));updateScore();}
function updateScore(){var el=document.getElementById('scoreDisplay');el.textContent=(currentPointType==='ìƒì '?'+':'-')+currentScore;el.style.color=currentPointType==='ìƒì '?'var(--green)':'var(--red)';}

function saveManualPoints(){
  if(!manualSelectedStudent){showToast('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');return;}
  var reason=document.getElementById('pointReason').value.trim();if(!reason){showToast('ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  showLoading(true);
  callServer('savePoints',{studentNum:manualSelectedStudent.num,studentName:manualSelectedStudent.name,type:currentPointType,score:currentScore,reason:reason})
  .then(function(r){showLoading(false);if(r.success){showToast('âœ… ìƒë²Œì  ì €ì¥!');document.getElementById('pointReason').value='';currentScore=1;updateScore();}}).catch(handleError);
}

// === ì¡°íšŒ ===
function loadStudentsSummary(){showLoading(true);callServer('getAllStudentsSummary').then(function(d){students=d;renderStudentList();showLoading(false);}).catch(handleError);}
function renderStudentList(){
  var c=document.getElementById('studentList');c.innerHTML='';
  var q=document.getElementById('searchInput')?document.getElementById('searchInput').value:'';
  students.filter(function(s){return !q||s.name.includes(q);}).forEach(function(s){
    var card=document.createElement('div');card.className='student-card';card.onclick=function(){showDetail(s);};
    var meta='ë©”ëª¨ '+(s.memoCount||0)+'ê±´';
    if(s.totalPoints&&s.totalPoints!==0){var cls=s.totalPoints>0?'pts-pos':'pts-neg';meta+=' <span class="'+cls+'" style="margin-left:8px">ìƒë²Œì  '+(s.totalPoints>0?'+':'')+s.totalPoints+'</span>';}
    card.innerHTML='<div class="student-avatar">'+s.num+'</div><div style="flex:1"><div class="student-card-name">'+s.name+'</div><div class="student-card-meta">'+meta+'</div></div><div class="student-card-arrow">â€º</div>';
    c.appendChild(card);
  });
}
function filterStudents(){renderStudentList();}

function showDetail(st){
  document.getElementById('searchList').style.display='none';document.getElementById('detailView').style.display='block';
  document.getElementById('detailHeader').innerHTML='<div class="detail-avatar">'+st.num+'</div><div class="detail-name">'+st.name+'</div><div class="detail-stats"><div><div class="detail-stat-num" id="dmc">-</div><div class="detail-stat-label">ë©”ëª¨</div></div><div class="detail-stat-divider"></div><div><div class="detail-stat-num" id="dpt">-</div><div class="detail-stat-label">ìƒë²Œì </div></div></div>';
  callServer('getStudentMemos',{studentName:st.name}).then(function(memos){
    document.getElementById('dmc').textContent=memos.length;
    var h='<div class="section-label">ë©”ëª¨ ê¸°ë¡</div>';
    if(!memos.length)h+='<div class="empty-state">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    else memos.forEach(function(m){h+='<div class="memo-item"><div class="memo-item-top"><span class="memo-category cat-'+m.category+'">'+m.category+'</span><span class="memo-date">'+m.date+' '+m.time+'</span></div><div class="memo-content">'+m.content+'</div></div>';});
    document.getElementById('detailMemos').innerHTML=h;
  }).catch(handleError);
  callServer('getStudentPoints',{studentName:st.name}).then(function(pts){
    var total=pts.reduce(function(s,p){return s+p.score;},0);var el=document.getElementById('dpt');el.textContent=(total>0?'+':'')+total;el.style.color=total>=0?'var(--green)':'var(--red)';
    var h='<div class="section-label">ìƒë²Œì  ë‚´ì—­</div>';
    if(!pts.length)h+='<div class="empty-state">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    else pts.forEach(function(p){h+='<div class="point-item"><div class="point-badge '+(p.score>0?'merit':'demerit')+'">'+(p.score>0?'+':'')+p.score+'</div><div style="flex:1"><div class="point-reason">'+p.reason+'</div><div class="point-date">'+p.date+'</div></div></div>';});
    document.getElementById('detailPoints').innerHTML=h;
  }).catch(handleError);
}
function backToList(){document.getElementById('detailView').style.display='none';document.getElementById('searchList').style.display='block';loadStudentsSummary();}

// === ìœ í‹¸ ===
function showLoading(s){var el=document.getElementById('loading');if(s)el.classList.add('show');else el.classList.remove('show');}
function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2500);}
function handleError(e){showLoading(false);showToast('ì˜¤ë¥˜: '+(e&&e.message?e.message:'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));console.error(e);}

function toggleMicGuide(){var p=document.getElementById('micGuide');if(p.style.display==='block'){p.style.display='none';}else{p.style.display='block';checkMic();}}
function checkMic(){
  var s=document.getElementById('micStatus');
  if(navigator.permissions&&navigator.permissions.query){
    navigator.permissions.query({name:'microphone'}).then(function(r){
      if(r.state==='granted')s.innerHTML='<span class="mic-badge mic-ok">âœ… ë§ˆì´í¬ í—ˆìš©ë¨</span>';
      else if(r.state==='denied')s.innerHTML='<span class="mic-badge mic-no">ğŸš« ì°¨ë‹¨ë¨ â€” ì•„ë˜ ë°©ë²•ìœ¼ë¡œ í—ˆìš©í•˜ì„¸ìš”</span>';
      else s.innerHTML='<span class="mic-badge mic-wait">â³ ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ íŒì—…ì´ ë– ìš”</span>';
    }).catch(function(){s.innerHTML='<span class="mic-badge mic-wait">â„¹ï¸ ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</span>';});
  } else s.innerHTML='<span class="mic-badge mic-wait">â„¹ï¸ ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸</span>';
}
</script>
</body>
</html>
